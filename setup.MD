# üöÄ Setup Completo - Cadastro Unificado (10.13.65.37)

## üìã Configura√ß√£o para Desenvolvedor Senior Django + Flutter

### üéØ Objetivo
Configurar ambiente completo com:
- **Backend**: Django + PostgreSQL + Redis + Nginx (Linux)
- **Frontend**: Flutter (Windows PowerShell)
- **TLS**: Certificados pr√≥prios (n√£o auto-assinados)
- **IP**: 10.13.65.37 (configurado no `server_name` do Nginx)

---

## üîß 1. Configura√ß√£o do Backend (Linux)

### 1.1. Configura√ß√£o do Nginx para 10.13.65.37

O arquivo `nginx.conf` est√° configurado especificamente para o IP **10.13.65.37**:

```nginx
# Servidor HTTPS principal
server {
    listen 443 ssl http2;
    server_name 10.13.65.37;  # üëà Configura√ß√£o espec√≠fica para seu IP
    
    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;
    
    # ... resto da configura√ß√£o
}

# Redirecionamento HTTP -> HTTPS
server {
    listen 80;
    server_name 10.13.65.37;  # üëà Mesmo IP aqui
    return 301 https://$server_name$request_uri;
}
```

### 1.2. Executar Setup Backend

```bash
# Dar permiss√£o de execu√ß√£o
chmod +x setup-backend.sh

# Executar setup completo
./setup-backend.sh
```

**O script ir√°:**
- ‚úÖ Verificar Docker e Docker Compose
- üîê Gerar certificados SSL pr√≥prios para 10.13.65.37
- üèóÔ∏è Fazer build das imagens Docker
- üöÄ Iniciar containers (backend, redis, nginx)
- üîÑ Executar migrations Django
- üì¶ Coletar arquivos est√°ticos
- üåê Testar conectividade
- üë§ Criar superusu√°rio (opcional)

### 1.3. URLs do Backend Dispon√≠veis

| Servi√ßo | HTTP | HTTPS |
|---------|------|-------|
| **API Django** | http://10.13.65.37:8001/api/v1/ | https://10.13.65.37:8443/api/v1/ |
| **Documenta√ß√£o** | http://10.13.65.37:8001/api/docs/ | https://10.13.65.37:8443/api/docs/ |
| **Admin Django** | http://10.13.65.37:8001/admin/ | https://10.13.65.37:8443/admin/ |
| **Nginx** | http://10.13.65.37:8081/ | https://10.13.65.37:8443/ |

---

## üîß 2. Configura√ß√£o do Frontend (Windows PowerShell)

### 2.1. Executar Setup Frontend

```powershell
# Executar setup completo
.\setup-frontend.ps1

# Executar com build para web
.\setup-frontend.ps1 -Build -Device web

# Executar e rodar no Chrome
.\setup-frontend.ps1 -Run -Device chrome

# Limpeza completa
.\setup-frontend.ps1 -Clean
```

**O script ir√°:**
- ‚úÖ Verificar instala√ß√£o do Flutter
- üìù Criar arquivo `.env` com configura√ß√µes para 10.13.65.37
- üì¶ Instalar depend√™ncias (`flutter pub get`)
- üîÑ Gerar c√≥digo (build_runner)
- üåê Testar conectividade com backend
- üîç Executar an√°lise de c√≥digo
- üöÄ Executar app (se `-Run` especificado)

### 2.2. Configura√ß√£o Autom√°tica do .env

O script cria automaticamente:

```env
# API Configuration
API_BASE_URL=https://10.13.65.37:8443/api/v1
API_BASE_URL_DEV=http://10.13.65.37:8081/api/v1
API_TIMEOUT=30000

# Environment
ENVIRONMENT=development
DEBUG_MODE=true

# Security
ENABLE_SSL_PINNING=false
TRUST_SELF_SIGNED_CERTS=true
```

---

## üîê 3. Certificados TLS Pr√≥prios

### 3.1. Gera√ß√£o Autom√°tica

Os certificados s√£o gerados automaticamente pelo script backend:

```bash
# Gera√ß√£o manual se necess√°rio
openssl genpkey -algorithm RSA -out nginx/ssl/server.key -pkcs8
openssl req -new -x509 -key nginx/ssl/server.key -out nginx/ssl/server.crt \
    -days 365 -subj "/C=BR/ST=RS/L=NovoHamburgo/O=Development/CN=10.13.65.37" \
    -addext "subjectAltName=IP:10.13.65.37,DNS:localhost"
```

### 3.2. Localiza√ß√£o dos Certificados

```
nginx/
‚îî‚îÄ‚îÄ ssl/
    ‚îú‚îÄ‚îÄ server.key     # Chave privada
    ‚îú‚îÄ‚îÄ server.crt     # Certificado p√∫blico
    ‚îî‚îÄ‚îÄ openssl.conf   # Configura√ß√£o OpenSSL
```

---

## üê≥ 4. Docker Compose

### 4.1. Comandos √öteis

```bash
# Iniciar todos os servi√ßos
docker compose up -d

# Ver logs em tempo real
docker compose logs -f backend
docker compose logs -f nginx

# Parar todos os servi√ßos
docker compose down

# Rebuild completo
docker compose down && docker compose build --no-cache && docker compose up -d

# Shell no container backend
docker compose exec backend bash

# Executar comando Django
docker compose exec backend python manage.py migrate
```

### 4.2. Estrutura dos Containers

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   nginx:alpine  ‚îÇ    ‚îÇ   python:3.11   ‚îÇ    ‚îÇ  redis:7-alpine ‚îÇ
‚îÇ   (Proxy/TLS)   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚î§   (Django API)  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚î§     (Cache)     ‚îÇ
‚îÇ   Port: 8081    ‚îÇ    ‚îÇ   Port: 8001    ‚îÇ    ‚îÇ   Port: 6379    ‚îÇ
‚îÇ   Port: 8443    ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ†Ô∏è 5. Troubleshooting

### 5.1. Problemas Comuns

#### ‚ùå "server_name n√£o funciona"
```bash
# Verificar se o IP est√° correto no nginx.conf
grep -n "server_name" nginx/nginx.conf

# Reiniciar nginx
docker compose restart nginx
```

#### ‚ùå "Certificado SSL inv√°lido"
```bash
# Verificar certificado
openssl x509 -in nginx/ssl/server.crt -noout -subject -dates -ext subjectAltName

# Regenerar se necess√°rio
rm nginx/ssl/server.*
./setup-backend.sh
```

#### ‚ùå "CORS errors no Flutter"
```bash
# Verificar configura√ß√µes CORS no Django
docker compose exec backend python manage.py shell
>>> from django.conf import settings
>>> print(settings.CORS_ALLOWED_ORIGINS)
```

#### ‚ùå "Backend n√£o acess√≠vel"
```bash
# Verificar containers
docker compose ps

# Verificar logs
docker compose logs backend --tail=50

# Testar conectividade
curl -I http://10.13.65.37:8081/nginx-health
curl -I -k https://10.13.65.37:8443/nginx-health
```

### 5.2. Comandos de Diagn√≥stico

```bash
# Verificar portas em uso
sudo netstat -tulpn | grep -E ':(8001|8081|8443)'

# Verificar containers
docker compose ps
docker stats

# Verificar certificados
openssl s_client -connect 10.13.65.37:8443 -servername 10.13.65.37

# Testar DNS/conectividade
ping 10.13.65.37
telnet 10.13.65.37 8081
```

---

## üìö 6. Comandos de Desenvolvimento

### 6.1. Backend (Django)

```bash
# Migrations
docker compose exec backend python manage.py makemigrations
docker compose exec backend python manage.py migrate

# Shell Django
docker compose exec backend python manage.py shell

# Testes
docker compose exec backend python manage.py test

# Criar app
docker compose exec backend python manage.py startapp nova_app
```

### 6.2. Frontend (Flutter)

```powershell
# Hot reload (durante desenvolvimento)
flutter run -d chrome --dart-define-from-file=.env

# Build para produ√ß√£o
flutter build web --release

# Testes
flutter test

# An√°lise de c√≥digo
flutter analyze
```

---

## üéØ 7. Configura√ß√µes Espec√≠ficas para 10.13.65.37

### 7.1. Django Settings

```python
# Hosts permitidos
ALLOWED_HOSTS = ['localhost', '127.0.0.1', '10.13.65.37']

# CORS Origins
CORS_ALLOWED_ORIGINS = [
    'https://10.13.65.37:3000',
    'https://10.13.65.37',
    'http://10.13.65.37:8001',
    'http://10.13.65.37:8081'
]

# CSRF Trusted Origins (apenas para produ√ß√£o)
CSRF_TRUSTED_ORIGINS = [
    'https://10.13.65.37',
    'https://10.13.65.37:8443'
]
```

### 7.2. Flutter Configuration

```dart
// lib/core/config/api_config.dart
class ApiConfig {
  static const String baseUrl = String.fromEnvironment(
    'API_BASE_URL',
    defaultValue: 'https://10.13.65.37:8443/api/v1',
  );
  
  static const String baseUrlDev = String.fromEnvironment(
    'API_BASE_URL_DEV', 
    defaultValue: 'http://10.13.65.37:8081/api/v1',
  );
}
```

---

## ‚úÖ 8. Checklist Final

### Backend
- [ ] Docker Compose instalado (v2 prefer√≠vel)
- [ ] Certificados SSL gerados
- [ ] Containers rodando (backend, redis, nginx)
- [ ] Migrations executadas
- [ ] API respondendo em 10.13.65.37:8001 e 10.13.65.37:8081
- [ ] HTTPS funcionando em 10.13.65.37:8443

### Frontend
- [ ] Flutter SDK instalado (3.16+)
- [ ] Depend√™ncias instaladas (`flutter pub get`)
- [ ] Arquivo `.env` configurado
- [ ] Build runner executado
- [ ] App conectando com backend via HTTPS
- [ ] CORS configurado corretamente

### Testes
- [ ] `curl http://10.13.65.37:8081/nginx-health` ‚Üí 200 OK
- [ ] `curl -k https://10.13.65.37:8443/nginx-health` ‚Üí 200 OK
- [ ] Flutter app fazendo requisi√ß√µes com sucesso
- [ ] Admin Django acess√≠vel
- [ ] Documenta√ß√£o API acess√≠vel

---

## üéâ Setup Conclu√≠do!

Ap√≥s seguir este guia, voc√™ ter√°:
- ‚úÖ Backend Django rodando com TLS em **10.13.65.37**
- ‚úÖ Nginx configurado como proxy reverso com `server_name 10.13.65.37`
- ‚úÖ Certificados pr√≥prios (n√£o auto-assinados) funcionando
- ‚úÖ Flutter conectando via HTTPS
- ‚úÖ Scripts automatizados para desenvolvimento

**URLs principais:**
- üåê **API**: https://10.13.65.37:8443/api/v1/
- üìñ **Docs**: https://10.13.65.37:8443/api/docs/
- ‚öôÔ∏è **Admin**: https://10.13.65.37:8443/admin/